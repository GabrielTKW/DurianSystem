<!DOCTYPE html>
<html lang="en">

<head>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Durian Track & Trace Blockchain</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
	<style>
		body {
			color: #566787;
			background: #f5f5f5;
			font-family: 'Varela Round', sans-serif;
			font-size: 13px;
		}

		.table-responsive {
			margin: 30px 0;
		}

		.table-wrapper {
			background: #fff;
			padding: 20px 25px;
			border-radius: 3px;
			min-width: 1000px;
			box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
		}

		.table-title {
			padding-bottom: 15px;
			background: green;
			color: #fff;
			padding: 16px 30px;
			min-width: 100%;
			margin: -20px -25px 10px;
			border-radius: 3px 3px 0 0;
		}

		.table-title h2 {
			margin: 5px 0 0;
			font-size: 24px;
		}

		.table-title .btn-group {
			float: right;
		}

		.table-title .btn {
			color: #fff;
			float: right;
			font-size: 13px;
			border: none;
			min-width: 50px;
			border-radius: 2px;
			border: none;
			outline: none !important;
			margin-left: 10px;
		}

		.table-title .btn i {
			float: left;
			font-size: 21px;
			margin-right: 5px;
		}

		.table-title .btn span {
			float: left;
			margin-top: 2px;
		}

		table.table tr th,
		table.table tr td {
			border-color: #e9e9e9;
			padding: 12px 15px;
			vertical-align: middle;
		}

		table.table tr th:first-child {
			width: 60px;
		}

		table.table tr th:last-child {
			width: 100px;
		}

		table.table-striped tbody tr:nth-of-type(odd) {
			background-color: #fcfcfc;
		}

		table.table-striped.table-hover tbody tr:hover {
			background: #f5f5f5;
		}

		table.table th i {
			font-size: 13px;
			margin: 0 5px;
			cursor: pointer;
		}

		table.table td:last-child i {
			opacity: 0.9;
			font-size: 22px;
			margin: 0 5px;
		}

		table.table td a {
			font-weight: bold;
			color: #566787;
			display: inline-block;
			text-decoration: none;
			outline: none !important;
		}

		table.table td a:hover {
			color: #2196F3;
		}

		table.table td a.edit {
			color: #FFC107;
		}

		table.table td a.delete {
			color: #F44336;
		}

		table.table td i {
			font-size: 19px;
		}

		table.table .avatar {
			border-radius: 50%;
			vertical-align: middle;
			margin-right: 10px;
		}

		.pagination {
			float: right;
			margin: 0 0 5px;
		}

		.pagination li a {
			border: none;
			font-size: 13px;
			min-width: 30px;
			min-height: 30px;
			color: #999;
			margin: 0 2px;
			line-height: 30px;
			border-radius: 2px !important;
			text-align: center;
			padding: 0 6px;
		}

		.pagination li a:hover {
			color: #666;
		}

		.pagination li.active a,
		.pagination li.active a.page-link {
			background: #03A9F4;
		}

		.pagination li.active a:hover {
			background: #0397d6;
		}

		.pagination li.disabled i {
			color: #ccc;
		}

		.pagination li i {
			font-size: 16px;
			padding-top: 6px
		}

		.hint-text {
			float: left;
			margin-top: 10px;
			font-size: 13px;
		}

		/* Custom checkbox */
		.custom-checkbox {
			position: relative;
		}

		.custom-checkbox input[type="checkbox"] {
			opacity: 0;
			position: absolute;
			margin: 5px 0 0 3px;
			z-index: 9;
		}

		.custom-checkbox label:before {
			width: 18px;
			height: 18px;
		}

		.custom-checkbox label:before {
			content: '';
			margin-right: 10px;
			display: inline-block;
			vertical-align: text-top;
			background: white;
			border: 1px solid #bbb;
			border-radius: 2px;
			box-sizing: border-box;
			z-index: 2;
		}

		.custom-checkbox input[type="checkbox"]:checked+label:after {
			content: '';
			position: absolute;
			left: 6px;
			top: 3px;
			width: 6px;
			height: 11px;
			border: solid #000;
			border-width: 0 3px 3px 0;
			transform: inherit;
			z-index: 3;
			transform: rotateZ(45deg);
		}

		.custom-checkbox input[type="checkbox"]:checked+label:before {
			border-color: #03A9F4;
			background: #03A9F4;
		}

		.custom-checkbox input[type="checkbox"]:checked+label:after {
			border-color: #fff;
		}

		.custom-checkbox input[type="checkbox"]:disabled+label:before {
			color: #b8b8b8;
			cursor: auto;
			box-shadow: none;
			background: #ddd;
		}

		/* Modal styles */
		.modal .modal-dialog {
			max-width: 400px;
		}

		.modal .modal-header,
		.modal .modal-body,
		.modal .modal-footer {
			padding: 20px 30px;
		}

		.modal .modal-content {
			border-radius: 3px;
			font-size: 14px;
		}

		.modal .modal-footer {
			background: #ecf0f1;
			border-radius: 0 0 3px 3px;
		}

		.modal .modal-title {
			display: inline-block;
		}

		.modal .form-control {
			border-radius: 2px;
			box-shadow: none;
			border-color: #dddddd;
		}

		.modal textarea.form-control {
			resize: vertical;
		}

		.modal .btn {
			border-radius: 2px;
			min-width: 100px;
		}

		.modal form label {
			font-weight: normal;
		}
	</style>
	<script>
		$(document).ready(function () {
			// Activate tooltip
			$('[data-toggle="tooltip"]').tooltip();

			// Select/Deselect checkboxes
			var checkbox = $('table tbody input[type="checkbox"]');
			$("#selectAll").click(function () {
				if (this.checked) {
					checkbox.each(function () {
						this.checked = true;
					});
				} else {
					checkbox.each(function () {
						this.checked = false;
					});
				}
			});
			checkbox.click(function () {
				if (!this.checked) {
					$("#selectAll").prop("checked", false);
				}
			});
		});

		let account;
		window.onload = function () {
			accessToContract();
			accessToMetamask();
		}


		const accessToMetamask = async () => {
			if (window.ethereum !== "undefined") {
				const accounts = await ethereum.request({
					method: "eth_requestAccounts"
				});
				account = accounts[0];
				//check the address which position is the user 
				

				var data = await window.contract.methods.searchUser(account).call();

				document.getElementById("accountArea").innerHTML = account;
				
				

				document.getElementById("accountPos").innerHTML = await window.contract.methods.getPositionToString(data[0]).call();

			}
		}

		//2- connect to smart contract
        const accessToContract = async () => {
            //change this ABIchange
            const ABI =[
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianType",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianFarm",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianTree",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_qty",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_price",
				"type": "uint256"
			}
		],
		"name": "addDurian",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_buyerAddress",
				"type": "address"
			}
		],
		"name": "addPurchase",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_customerAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_qty",
				"type": "uint256"
			}
		],
		"name": "addPurchaseCustomer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "purchaseID",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_rating",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "desc",
				"type": "string"
			}
		],
		"name": "addReview",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "pos",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			}
		],
		"name": "addUser",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			}
		],
		"name": "buyDurian",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "number",
				"type": "uint256"
			}
		],
		"name": "checkDurianState",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "newOwnership",
				"type": "address"
			}
		],
		"name": "listDurianToSell",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_newState",
				"type": "uint256"
			}
		],
		"name": "setDurianStateByDurianID",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "userInputID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianType",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianFarm",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianTree",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_qty",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_price",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "newAddress",
				"type": "address"
			}
		],
		"name": "updateDurian",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_purchaseID",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_retailAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_newPrice",
				"type": "uint256"
			}
		],
		"name": "updatePurchase",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "pos",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			}
		],
		"name": "updateUser",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			}
		],
		"name": "checkDuplicateUser",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "durian",
		"outputs": [
			{
				"internalType": "string",
				"name": "durianID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "durianType",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "durianFarm",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "durianTree",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "qty",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			},
			{
				"internalType": "enum myDurianContract.DurianState",
				"name": "durianState",
				"type": "uint8"
			},
			{
				"internalType": "address",
				"name": "ownership",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "durianRec",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "valueEther",
				"type": "uint256"
			}
		],
		"name": "etherToWei",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			}
		],
		"name": "getDurianData",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "durianID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianType",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianFarm",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianTree",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "qty",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "price",
						"type": "uint256"
					},
					{
						"internalType": "enum myDurianContract.DurianState",
						"name": "durianState",
						"type": "uint8"
					},
					{
						"internalType": "address",
						"name": "ownership",
						"type": "address"
					}
				],
				"internalType": "struct myDurianContract.Durian",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getDurianTotal",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			}
		],
		"name": "getPositionByUserID",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "getPositionToString",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_purchaseID",
				"type": "string"
			}
		],
		"name": "getPurchaseData",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "purchaseID",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "purchaseTime",
						"type": "uint256"
					},
					{
						"components": [
							{
								"internalType": "string",
								"name": "durianID",
								"type": "string"
							},
							{
								"internalType": "string",
								"name": "durianType",
								"type": "string"
							},
							{
								"internalType": "string",
								"name": "durianFarm",
								"type": "string"
							},
							{
								"internalType": "string",
								"name": "durianTree",
								"type": "string"
							},
							{
								"internalType": "uint256",
								"name": "qty",
								"type": "uint256"
							},
							{
								"internalType": "uint256",
								"name": "price",
								"type": "uint256"
							},
							{
								"internalType": "enum myDurianContract.DurianState",
								"name": "durianState",
								"type": "uint8"
							},
							{
								"internalType": "address",
								"name": "ownership",
								"type": "address"
							}
						],
						"internalType": "struct myDurianContract.Durian",
						"name": "durian",
						"type": "tuple"
					},
					{
						"internalType": "address",
						"name": "buyerAddress",
						"type": "address"
					},
					{
						"internalType": "bool",
						"name": "retailGet",
						"type": "bool"
					},
					{
						"internalType": "address",
						"name": "retailAddress",
						"type": "address"
					},
					{
						"internalType": "string",
						"name": "reviewID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "reviewDescription",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "rating",
						"type": "uint256"
					}
				],
				"internalType": "struct myDurianContract.Purchase",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_purchaseID",
				"type": "string"
			}
		],
		"name": "getPurchaseDurianData",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "durianID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianType",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianFarm",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianTree",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "qty",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "price",
						"type": "uint256"
					},
					{
						"internalType": "enum myDurianContract.DurianState",
						"name": "durianState",
						"type": "uint8"
					},
					{
						"internalType": "address",
						"name": "ownership",
						"type": "address"
					}
				],
				"internalType": "struct myDurianContract.Durian",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getPurchaseLength",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "length",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "getUserAddressByIndex",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getUserLength",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "length",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			}
		],
		"name": "isDurianInFarm",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address payable",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "purchaseList",
		"outputs": [
			{
				"internalType": "string",
				"name": "purchaseID",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "purchaseTime",
				"type": "uint256"
			},
			{
				"components": [
					{
						"internalType": "string",
						"name": "durianID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianType",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianFarm",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianTree",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "qty",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "price",
						"type": "uint256"
					},
					{
						"internalType": "enum myDurianContract.DurianState",
						"name": "durianState",
						"type": "uint8"
					},
					{
						"internalType": "address",
						"name": "ownership",
						"type": "address"
					}
				],
				"internalType": "struct myDurianContract.Durian",
				"name": "durian",
				"type": "tuple"
			},
			{
				"internalType": "address",
				"name": "buyerAddress",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "retailGet",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "retailAddress",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "reviewID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "reviewDescription",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "rating",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "durianIDinput",
				"type": "string"
			}
		],
		"name": "searchDurianIndex",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "purchaseID",
				"type": "string"
			}
		],
		"name": "searchPurchaseIndex",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			}
		],
		"name": "searchUser",
		"outputs": [
			{
				"components": [
					{
						"internalType": "enum myDurianContract.Position",
						"name": "position",
						"type": "uint8"
					},
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "userID",
						"type": "string"
					}
				],
				"internalType": "struct myDurianContract.User",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "searchUserByIndex",
		"outputs": [
			{
				"components": [
					{
						"internalType": "enum myDurianContract.Position",
						"name": "position",
						"type": "uint8"
					},
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "userID",
						"type": "string"
					}
				],
				"internalType": "struct myDurianContract.User",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "userAddressArray",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "userList",
		"outputs": [
			{
				"internalType": "enum myDurianContract.Position",
				"name": "position",
				"type": "uint8"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "userID",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];


            //change this addressChange
            const Address = "0xFa88b37A05E4c8C867448F1b71f0Dfb31deFe06C";
            
            window.web3 = await new Web3(window.ethereum); //how to access to smart contract 
            window.contract = await new window.web3.eth.Contract( ABI, Address); //how you create an instance of that contract by using the abi and address  
            document.getElementById("contractArea").innerHTML = "connected to Product smart contract";
        }


		function isEmpty(str) {
    		return !str.length;
		}

		const addDurian = async()=>{
			//get data first 
			const durianType = document.getElementById("durianTypeAdd").value; 
			const durianFarm = document.getElementById("durianFarmAdd").value; 
			const durianTree = document.getElementById("durianTreeAdd").value; 
			const qty = document.getElementById("Qty").value; //need to change to int
			const durianPrice = document.getElementById("addDurianPrice").value; //change to int 

			if(isEmpty(durianType)){
				document.getElementById('addErrorMessage').innerHTML ="durian type is empty";
			}else if (isEmpty(durianFarm)){
				document.getElementById('addErrorMessage').innerHTML ="durian farm is empty";
			}else if (isEmpty(durianTree)){
				document.getElementById('addErrorMessage').innerHTML ="durian tree is empty";
			}else if (isEmpty(qty)){
				document.getElementById('addErrorMessage').innerHTML ="quantity fill is empty";
			}else if (isEmpty(durianPrice)){
				document.getElementById('addErrorMessage').innerHTML ="durian price is empty";
			}

			await window.contract.methods.addDurian(durianType , durianFarm , durianTree,parseInt(qty),parseInt(durianPrice)).send({from: account });

			document.getElementById("durianTypeAdd").value = "";
		  	document.getElementById("durianFarmAdd").value= "";
          	document.getElementById("durianTreeAdd").value= "";
			document.getElementById("Qty").value= "";
			document.getElementById("addDurianPrice").value= "";


			document.getElementById('addErrorMessage').innerHTML ="Successfully added the durian";
		}

		
		const  getAllDurianPurchaseHistory= async() =>{
             // get purchase length 
             const purchaseLength = await window.contract.methods.getPurchaseLength().call();
            var row=``

            //Only print purchase under my ID 
            for(var i = 0 ; i < parseInt(purchaseLength) ; i++){
				var purchaseID = "P"+(i+1);
				var purchase = await window.contract.methods.getPurchaseData(purchaseID).call();

                //only print those who is the customers 
                var customers = String(purchase[3]);

                //only get those records where retailer send it to u 
                if(customers.toUpperCase()===account.toUpperCase()){
                    
                    //Get Durian Data (inside purchase)
                    var durian = await window.contract.methods.getPurchaseDurianData(purchase[0]).call();

                    var row = row +`<tr>
                        
                        <td>${purchase[0]}</td><td>${durian[0]}</td><td>${durian[1]}</td><td>${durian[2]}</td><td>${durian[3]}</td><td>${durian[4]}</td><td>${durian[5]}</td>

                        <td>
                        <a href="#editDurianModal" data-toggle="modal"><button class="btn" onclick="syncEditData(\'${purchase[0]}\')" ><i class="material-icons"
                                            data-toggle="tooltip" title="Edit">&#xE254;</i></button></a>
                                </td></tr>`;

			    }
            }
            document.getElementById("tableBody").innerHTML=row;

		}




		const syncEditData = async(i) =>{
			//this one sync for durian edit
		  	document.getElementById("PurchaseIDUpdate").value= i;
		}

        const addReview = async() =>{
            const purchaseID = document.getElementById("PurchaseIDUpdate").value;
            var ratingDurian ;
            const reviewDescription = document.getElementById("reviewDescription").value;


            
            var ele = document.getElementsByName('rate');
     
            for (i = 0; i < ele.length; i++) {
                if (ele[i].checked)
                    
                    ratingDurian = ele[i].value;
            }
    


            console.log(purchaseID +" "+ratingDurian+" "+reviewDescription);

            if(isEmpty(purchaseID)){
				document.getElementById('addErrorMessage').innerHTML ="Purchase ID is empty";
			}else if (isEmpty(reviewDescription)){
				document.getElementById('addErrorMessage').innerHTML ="reviewDescription is empty";
			}else{
                //add review
                await window.contract.methods.addReview(purchaseID,ratingDurian,reviewDescription).send({from: account });

                console.log("Finnish add review")
            }
        }


        
        

		

		
		</script>
</head>

<body>
	<header>
        <div class="nav container" style="margin-top: 30px;">
            <form method="POST" action="/manageUser.html"><li><input type="submit" value="Manage User" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 20px;border-radius: 5px;" /></li></form>
			<form method="POST" action="/manageDurian.html"><li><input type="submit" value="Durian Farm" style="width: 175px;height: 30px;background-color:black;border: none;color: white; margin-left: 10px;border-radius: 5px;"/></li></form>
			<form method="POST" action="/distributor.html"><li><input type="submit" value="Distribution Center" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 10px;border-radius: 5px;"/></li></form>
			<form method="POST" action="/retailer.html"><li><input type="submit" value="Retailer" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 10px;border-radius: 5px;"/></li></form>
			<form method="POST" action="/buyDurianPage.html"><li><input type="submit" value="Durian Market" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 10px;border-radius: 5px;"/></li></form>
            <form method="POST" action="/review.html"><li><input type="submit" value="All Review Page" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 10px;border-radius: 5px;"/></li></form>
        </div>
    </header>
	<div class="container-xl">
		<div class="table-responsive">
			<div class="table-wrapper">
				<div class="table-title">
					<div class="row">
						<div class="col-sm-6">
							<h2>History and Review Page</b> </h2>
							
						</div>
						<div class="col-sm-6">
							<a onclick ="getAllDurianPurchaseHistory() " class="btn btn-warning" data-toggle="modal"><i
								class="material-icons">&#xf021;</i> <span>Update Table Records</span></a>
						</div>
					</div>
				</div>
				<table class="table table-striped table-hover" id="FullDurianRecordTable">
					<thead>
						<tr>    
                            <th>Purchase ID</th>
							<th>Durian ID</th>
							<th>Type</th>
							<th>Farm</th>
							<th>Tree</th>
							<th>Quantity</th>
							<th>Price</th>
							<th>Review</th>
						</tr>
					</thead>
					<tbody id ="tableBody">
						
					</tbody>
				</table>
				<!--DONT DELETE HERE-->
				<p></p>
				<table id="FullDurianRecordTable"></table>
				<p id="getAllDurianRecordMessage"></p>


				<br>
				<button onclick="accessToMetamask()" class="btn btn-success">Connect Metamask</button> <br>
				<p id="accountArea"></p>
				<br>

				<button onclick="accessToContract()" class="btn btn-warning">Connect to Smart Contract</button> <br>
				<p id="contractArea"></p>
				<br>

			</div>
		</div>
	</div>
	

	<!-- Review Modal HTML -->
	<div id="editDurianModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header">
						<h4 class="modal-title">Add Review</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="lname">Purchase ID:</label>
							<input type="text" id="PurchaseIDUpdate" class="form-control" readonly><br>
						</div>
						<div class="ratingDurian">
                            <input type="radio" id="star1" name="rate" value="1" />
                            <label for="star1" title="text">1 star</label>
                            <input type="radio" id="star2" name="rate" value="2" />
                            <label for="star2" title="text">2 stars</label>
                            <input type="radio" id="star3" name="rate" value="3" />
                            <label for="star3" title="text">3 stars</label>
                            <input type="radio" id="star4" name="rate" value="4" />
                            <label for="star4" title="text">4 stars</label>
                            <input type="radio" id="star5" name="rate" value="5" />
                            <label for="star5" title="text">5 stars</label>
                        </div>
						<div class="form-group">
							<label>Review Description:</label>
							<input type="text" id="reviewDescription" class="form-control"><br>
						</div>
			
						<p id="addErrorMessage"></p>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<button id="submit" type="button" onclick="addReview()" class="btn btn-success">Submit
							</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	
</body>

</html>