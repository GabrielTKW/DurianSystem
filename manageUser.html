<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Durian Track & Trace Blockchain</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
	 <!-- basic -->
	 <meta charset="utf-8">
	 <meta http-equiv="X-UA-Compatible" content="IE=edge">
	 <meta name="viewport" content="width=device-width, initial-scale=1">
	 <!-- mobile metas -->
	 <meta name="viewport" content="width=device-width, initial-scale=1">
	 <meta name="viewport" content="initial-scale=1, maximum-scale=1">
	 <!-- site metas -->
	 <title>Durian</title>
	 <meta name="keywords" content="">
	 <meta name="description" content="">
	 <meta name="author" content="">
	 <!-- bootstrap css -->
	 <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	 <!-- style css -->
	 <link rel="stylesheet" type="text/css" href="css/style.css">
	 
	 <!-- Responsive-->
	 <link rel="stylesheet" href="css/responsive.css">
	 <!-- fevicon -->
	 <link rel="icon" href="images/fevicon.png" type="image/gif" />
	 <!-- Scrollbar Custom CSS -->
	 <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
	 <!-- Tweaks for older IEs-->
	 <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
	 <!-- fonts -->
	 <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	 <!-- font awesome -->
	 <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	 <!--  -->
	 <!-- owl stylesheets -->
	 <link href="https://fonts.googleapis.com/css?family=Great+Vibes|Poppins:400,700&display=swap&subset=latin-ext" rel="stylesheet">
	 <link rel="stylesheet" href="css/owl.carousel.min.css">
	 <link rel="stylesheet" href="css/owl.theme.default.min.css">
	 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
	<style>
		body {
			color: #566787;
			background: #f5f5f5;
			font-family: 'Varela Round', sans-serif;
			font-size: 13px;
		}

		.table-responsive {
			margin: 30px 0;
		}

		.table-wrapper {
			background: #fff;
			padding: 20px 25px;
			border-radius: 3px;
			min-width: 1000px;
			box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
		}

		.table-title {
			padding-bottom: 15px;
			background: #3977C3;
			color: #fff;
			padding: 16px 30px;
			min-width: 100%;
			margin: -20px -25px 10px;
			border-radius: 3px 3px 0 0;
		}

		.table-title h2 {
			margin: 5px 0 0;
			font-size: 24px;
		}

		.table-title .btn-group {
			float: right;
		}

		.table-title .btn {
			color: #fff;
			float: right;
			font-size: 13px;
			border: none;
			min-width: 50px;
			border-radius: 2px;
			border: none;
			outline: none !important;
			margin-left: 10px;
		}

		.table-title .btn i {
			float: left;
			font-size: 21px;
			margin-right: 5px;
		}

		.table-title .btn span {
			float: left;
			margin-top: 2px;
		}

		table.table tr th,
		table.table tr td {
			border-color: #e9e9e9;
			padding: 12px 15px;
			vertical-align: middle;
		}

		table.table tr th:first-child {
			width: 60px;
		}

		table.table tr th:last-child {
			width: 100px;
		}

		table.table-striped tbody tr:nth-of-type(odd) {
			background-color: #fcfcfc;
		}

		table.table-striped.table-hover tbody tr:hover {
			background: #f5f5f5;
		}

		table.table th i {
			font-size: 13px;
			margin: 0 5px;
			cursor: pointer;
		}

		table.table td:last-child i {
			opacity: 0.9;
			font-size: 22px;
			margin: 0 5px;
		}

		table.table td a {
			font-weight: bold;
			color: #566787;
			display: inline-block;
			text-decoration: none;
			outline: none !important;
		}

		table.table td a:hover {
			color: #2196F3;
		}

		table.table td a.edit {
			color: #FFC107;
		}

		table.table td a.delete {
			color: #F44336;
		}

		table.table td i {
			font-size: 19px;
		}

		table.table .avatar {
			border-radius: 50%;
			vertical-align: middle;
			margin-right: 10px;
		}

		.pagination {
			float: right;
			margin: 0 0 5px;
		}

		.pagination li a {
			border: none;
			font-size: 13px;
			min-width: 30px;
			min-height: 30px;
			color: #999;
			margin: 0 2px;
			line-height: 30px;
			border-radius: 2px !important;
			text-align: center;
			padding: 0 6px;
		}

		.pagination li a:hover {
			color: #666;
		}

		.pagination li.active a,
		.pagination li.active a.page-link {
			background: #03A9F4;
		}

		.pagination li.active a:hover {
			background: #0397d6;
		}

		.pagination li.disabled i {
			color: #ccc;
		}

		.pagination li i {
			font-size: 16px;
			padding-top: 6px
		}

		.hint-text {
			float: left;
			margin-top: 10px;
			font-size: 13px;
		}

		/* Custom checkbox */
		.custom-checkbox {
			position: relative;
		}

		.custom-checkbox input[type="checkbox"] {
			opacity: 0;
			position: absolute;
			margin: 5px 0 0 3px;
			z-index: 9;
		}

		.custom-checkbox label:before {
			width: 18px;
			height: 18px;
		}

		.custom-checkbox label:before {
			content: '';
			margin-right: 10px;
			display: inline-block;
			vertical-align: text-top;
			background: white;
			border: 1px solid #bbb;
			border-radius: 2px;
			box-sizing: border-box;
			z-index: 2;
		}

		.custom-checkbox input[type="checkbox"]:checked+label:after {
			content: '';
			position: absolute;
			left: 6px;
			top: 3px;
			width: 6px;
			height: 11px;
			border: solid #000;
			border-width: 0 3px 3px 0;
			transform: inherit;
			z-index: 3;
			transform: rotateZ(45deg);
		}

		.custom-checkbox input[type="checkbox"]:checked+label:before {
			border-color: #03A9F4;
			background: #03A9F4;
		}

		.custom-checkbox input[type="checkbox"]:checked+label:after {
			border-color: #fff;
		}

		.custom-checkbox input[type="checkbox"]:disabled+label:before {
			color: #b8b8b8;
			cursor: auto;
			box-shadow: none;
			background: #ddd;
		}

		/* Modal styles */
		.modal .modal-dialog {
			max-width: 400px;
		}

		.modal .modal-header,
		.modal .modal-body,
		.modal .modal-footer {
			padding: 20px 30px;
		}

		.modal .modal-content {
			border-radius: 3px;
			font-size: 14px;
		}

		.modal .modal-footer {
			background: #ecf0f1;
			border-radius: 0 0 3px 3px;
		}

		.modal .modal-title {
			display: inline-block;
		}

		.modal .form-control {
			border-radius: 2px;
			box-shadow: none;
			border-color: #dddddd;
		}

		.modal textarea.form-control {
			resize: vertical;
		}

		.modal .btn {
			border-radius: 2px;
			min-width: 100px;
		}

		.modal form label {
			font-weight: normal;
		}

		button-solid {
			padding: 5px 10px;
			background-color: #ddd;
			color: #000;
		}
	</style>
	<script>
		$(document).ready(function () {
			// Activate tooltip
			$('[data-toggle="tooltip"]').tooltip();

			// Select/Deselect checkboxes
			var checkbox = $('table tbody input[type="checkbox"]');
			$("#selectAll").click(function () {
				if (this.checked) {
					checkbox.each(function () {
						this.checked = true;
					});
				} else {
					checkbox.each(function () {
						this.checked = false;
					});
				}
			});
			checkbox.click(function () {
				if (!this.checked) {
					$("#selectAll").prop("checked", false);
				}
			});
		});

		let account;
		window.onload = function () {
			accessToContract();
			accessToMetamask();
		}


		const accessToMetamask = async () => {
			if (window.ethereum !== "undefined") {
				const accounts = await ethereum.request({
					method: "eth_requestAccounts"
				});
				account = accounts[0];
				//check the address which position is the user 
				

				var data = await window.contract.methods.searchUser(account).call();

				document.getElementById("accountArea").innerHTML = account;
				
				

				document.getElementById("accountPos").innerHTML = await window.contract.methods.getPositionToString(data[0]).call();

			}
		}

		//2- connect to smart contract
        const accessToContract = async () => {
            //change this ABIchange
            const ABI =[
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianType",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianFarm",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianTree",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_qty",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_price",
				"type": "uint256"
			}
		],
		"name": "addDurian",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_buyerAddress",
				"type": "address"
			}
		],
		"name": "addPurchase",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_customerAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_qty",
				"type": "uint256"
			}
		],
		"name": "addPurchaseCustomer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "purchaseID",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_rating",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "desc",
				"type": "string"
			}
		],
		"name": "addReview",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "pos",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			}
		],
		"name": "addUser",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			}
		],
		"name": "buyDurian",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "number",
				"type": "uint256"
			}
		],
		"name": "checkDurianState",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "newOwnership",
				"type": "address"
			}
		],
		"name": "listDurianToSell",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_newState",
				"type": "uint256"
			}
		],
		"name": "setDurianStateByDurianID",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "userInputID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianType",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianFarm",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_durianTree",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_qty",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_price",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "newAddress",
				"type": "address"
			}
		],
		"name": "updateDurian",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_purchaseID",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_retailAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_newPrice",
				"type": "uint256"
			}
		],
		"name": "updatePurchase",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "pos",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			}
		],
		"name": "updateUser",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			}
		],
		"name": "checkDuplicateUser",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "durian",
		"outputs": [
			{
				"internalType": "string",
				"name": "durianID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "durianType",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "durianFarm",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "durianTree",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "qty",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			},
			{
				"internalType": "enum myDurianContract.DurianState",
				"name": "durianState",
				"type": "uint8"
			},
			{
				"internalType": "address",
				"name": "ownership",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "durianRec",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "valueEther",
				"type": "uint256"
			}
		],
		"name": "etherToWei",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			}
		],
		"name": "getDurianData",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "durianID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianType",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianFarm",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianTree",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "qty",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "price",
						"type": "uint256"
					},
					{
						"internalType": "enum myDurianContract.DurianState",
						"name": "durianState",
						"type": "uint8"
					},
					{
						"internalType": "address",
						"name": "ownership",
						"type": "address"
					}
				],
				"internalType": "struct myDurianContract.Durian",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getDurianTotal",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			}
		],
		"name": "getPositionByUserID",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "getPositionToString",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_purchaseID",
				"type": "string"
			}
		],
		"name": "getPurchaseData",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "purchaseID",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "purchaseTime",
						"type": "uint256"
					},
					{
						"components": [
							{
								"internalType": "string",
								"name": "durianID",
								"type": "string"
							},
							{
								"internalType": "string",
								"name": "durianType",
								"type": "string"
							},
							{
								"internalType": "string",
								"name": "durianFarm",
								"type": "string"
							},
							{
								"internalType": "string",
								"name": "durianTree",
								"type": "string"
							},
							{
								"internalType": "uint256",
								"name": "qty",
								"type": "uint256"
							},
							{
								"internalType": "uint256",
								"name": "price",
								"type": "uint256"
							},
							{
								"internalType": "enum myDurianContract.DurianState",
								"name": "durianState",
								"type": "uint8"
							},
							{
								"internalType": "address",
								"name": "ownership",
								"type": "address"
							}
						],
						"internalType": "struct myDurianContract.Durian",
						"name": "durian",
						"type": "tuple"
					},
					{
						"internalType": "address",
						"name": "buyerAddress",
						"type": "address"
					},
					{
						"internalType": "bool",
						"name": "retailGet",
						"type": "bool"
					},
					{
						"internalType": "address",
						"name": "retailAddress",
						"type": "address"
					},
					{
						"internalType": "string",
						"name": "reviewID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "reviewDescription",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "rating",
						"type": "uint256"
					}
				],
				"internalType": "struct myDurianContract.Purchase",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_purchaseID",
				"type": "string"
			}
		],
		"name": "getPurchaseDurianData",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "durianID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianType",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianFarm",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianTree",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "qty",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "price",
						"type": "uint256"
					},
					{
						"internalType": "enum myDurianContract.DurianState",
						"name": "durianState",
						"type": "uint8"
					},
					{
						"internalType": "address",
						"name": "ownership",
						"type": "address"
					}
				],
				"internalType": "struct myDurianContract.Durian",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getPurchaseLength",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "length",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "getUserAddressByIndex",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getUserLength",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "length",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_durianID",
				"type": "string"
			}
		],
		"name": "isDurianInFarm",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address payable",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "purchaseList",
		"outputs": [
			{
				"internalType": "string",
				"name": "purchaseID",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "purchaseTime",
				"type": "uint256"
			},
			{
				"components": [
					{
						"internalType": "string",
						"name": "durianID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianType",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianFarm",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "durianTree",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "qty",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "price",
						"type": "uint256"
					},
					{
						"internalType": "enum myDurianContract.DurianState",
						"name": "durianState",
						"type": "uint8"
					},
					{
						"internalType": "address",
						"name": "ownership",
						"type": "address"
					}
				],
				"internalType": "struct myDurianContract.Durian",
				"name": "durian",
				"type": "tuple"
			},
			{
				"internalType": "address",
				"name": "buyerAddress",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "retailGet",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "retailAddress",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "reviewID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "reviewDescription",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "rating",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "durianIDinput",
				"type": "string"
			}
		],
		"name": "searchDurianIndex",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "purchaseID",
				"type": "string"
			}
		],
		"name": "searchPurchaseIndex",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			}
		],
		"name": "searchUser",
		"outputs": [
			{
				"components": [
					{
						"internalType": "enum myDurianContract.Position",
						"name": "position",
						"type": "uint8"
					},
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "userID",
						"type": "string"
					}
				],
				"internalType": "struct myDurianContract.User",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "searchUserByIndex",
		"outputs": [
			{
				"components": [
					{
						"internalType": "enum myDurianContract.Position",
						"name": "position",
						"type": "uint8"
					},
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "userID",
						"type": "string"
					}
				],
				"internalType": "struct myDurianContract.User",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "userAddressArray",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "userList",
		"outputs": [
			{
				"internalType": "enum myDurianContract.Position",
				"name": "position",
				"type": "uint8"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "userID",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];


            //change this addressChange
            const Address = "0xFa88b37A05E4c8C867448F1b71f0Dfb31deFe06C";
            
            window.web3 = await new Web3(window.ethereum); //how to access to smart contract 
            window.contract = await new window.web3.eth.Contract( ABI, Address); //how you create an instance of that contract by using the abi and address  
            document.getElementById("contractArea").innerHTML = "connected to Product smart contract";
        }

		const addUser = async () => {
		const userName = document.getElementById("userName").value;
        const userAddress = document.getElementById("userAddress").value;
        const userType = document.getElementById("userType").value;
		
		//check if its empty 
		if(isEmpty(userName)){
			document.getElementById('userAddErrorMessage').innerHTML ="Fill up userName";
		}else if (isEmpty(userAddress)){
			document.getElementById('userAddErrorMessage').innerHTML ="Fill up userAddress";
		}else if (isEmpty(userType)){
			document.getElementById('userAddErrorMessage').innerHTML ="Choose a userType";
		}


		const duplicateUser = await window.contract.methods.checkDuplicateUser(userAddress).call();
		
		if(!duplicateUser){
          await window.contract.methods.addUser(userAddress,parseInt(userType),userName).send({from: account });  

          document.getElementById("userName").value = "";
		  document.getElementById("userAddress").value= "";
          document.getElementById("userType").value= "";
		  document.getElementById('userAddErrorMessage').innerHTML ="Successfully added the user";
		}
		else {
			document.getElementById('userAddErrorMessage').innerHTML ="Address already registered in the system";
		}
		
        }

		function isEmpty(str) {
    		return !str.length;
		}

		const getUserData = async () => {
			const data = await window.contract.methods.searchUser(document.getElementById("getUserAddress").value).call();
			
			var str = `${data[2]}`;
			var str = str.replace('U','');
				
			var row = `<tr><td>${await window.contract.methods.getPositionToString(data[0]).call()}</td><td>${data[2]}</td><td>${data[1]}</td><td>${document.getElementById("getUserAddress").value}</td> <td>
					<a href="#editUserModal" data-toggle="modal"><button class="btn" onclick="syncEditData(${parseInt(str)-1})" ><i class="material-icons"
										data-toggle="tooltip" title="Edit">&#xE254;</i></button></a>
							</td></tr>`;
			

			document.getElementById("tableBody").innerHTML=row;
		}

		const getAllUserData = async() => {
			const addressLength = await window.contract.methods.getUserLength().call();
			var row=``;

			for(var i = 0 ; i < await window.contract.methods.getUserLength().call() ; i++){
				var localData ;
				localData = await window.contract.methods.searchUserByIndex(i).call();
				var userAddress = await window.contract.methods.getUserAddressByIndex(i).call();

				var row = row + `<tr><td>${await window.contract.methods.getPositionToString(localData[0]).call()}</td><td>${localData[2]}</td><td>${localData[1]}</td><td>${userAddress}</td> <td>
					<a href="#editUserModal" data-toggle="modal"><button class="btn" onclick="syncEditData(${i})" ><i class="material-icons"
										data-toggle="tooltip" title="Edit">&#xE254;</i></button></a>
							</td></tr>`;

			}

			document.getElementById("tableBody").innerHTML=row;
		}

		const syncEditData = async(i) => {
			//this one sync the data to edit 
			userAddress = await window.contract.methods.getUserAddressByIndex(i).call();
			document.getElementById("userAddressUpdate").value= userAddress;

			//put all the old data into the edit field 
			const data = await window.contract.methods.searchUser(userAddress).call();

			document.getElementById("userNameUpdate").value = `${data[1]}`;
			const $userPosOption = document.querySelector('#userPosUpdate');
			$userPosOption.value = `${data[0]}`;
		}

		const editUser = async() =>{
			const userName = document.getElementById("userNameUpdate").value;
			const userAddress = document.getElementById("userAddressUpdate").value;
			const userType = document.getElementById("userPosUpdate").value; //user position 
			
			//check if its empty 
			if(isEmpty(userName)){
				document.getElementById('userAddErrorMessage').innerHTML ="Fill up userName";
			}else if (isEmpty(userType)){
				document.getElementById('userAddErrorMessage').innerHTML ="Choose a userType";
			}
			//editUserMessage
			const duplicateUser = await window.contract.methods.checkDuplicateUser(userAddress).call();

			



			//if its found in the system the address
			if(duplicateUser){
				await window.contract.methods.updateUser(userAddress,parseInt(userType),userName).send({from: account });  

				document.getElementById("userNameUpdate").value = "";
				document.getElementById("userAddressUpdate").value= "";
				document.getElementById("userPosUpdate").value= "";
				document.getElementById('editUserMessage').innerHTML ="Successfully edited the user";
			}
		}


		
		
	</script>
</head>

<body>
	<header>
        <div class="nav container" style="margin-top: 30px;">
            <form method="POST" action="/manageUser.html"><li><input type="submit" value="Manage User" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 20px;border-radius: 5px;" /></li></form>
			<form method="POST" action="/manageDurian.html"><li><input type="submit" value="Durian Farm" style="width: 175px;height: 30px;background-color:black;border: none;color: white; margin-left: 10px;border-radius: 5px;"/></li></form>
			<form method="POST" action="/distributor.html"><li><input type="submit" value="Distribution Center" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 10px;border-radius: 5px;"/></li></form>
			<form method="POST" action="/retailer.html"><li><input type="submit" value="Retailer" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 10px;border-radius: 5px;"/></li></form>
			<form method="POST" action="/buyDurianPage.html"><li><input type="submit" value="Durian Market" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 10px;border-radius: 5px;"/></li></form>
            <form method="POST" action="/review.html"><li><input type="submit" value="All Review Page" style="width: 175px;height: 30px;background-color:black;border: none;color: white;margin-left: 10px;border-radius: 5px;"/></li></form>
        </div>
    </header>
	<div class="container-xl">
		<div class="table-responsive">
			<div class="table-wrapper">
				<div class="table-title">
					<div class="row">
						<div class="col-sm-6">
							<h2>Manage <b>Users</b> 
						</div>
						<div class="col-sm-6">
							<a href="#addUserModal" class="btn btn-success" data-toggle="modal"><i
									class="material-icons">&#xE147;</i> <span>Add New User</span></a>
							<a href="#searchUserModal" class="btn btn-warning" data-toggle="modal"><i
									class="material-icons">&#xe8b6;</i> <span>Search</span></a>
							<a onclick ="getAllUserData() " class="btn btn-warning" data-toggle="modal"><i
								class="material-icons">&#xf021;</i> <span>Update Table Records</span></a>
						</div>
					</div>
				</div>
				<table class="table table-striped table-hover" id="FullDurianRecordTable">
					<thead>
						<tr>
							<th>User Type</th>
							<th>User ID</th>
							<th>Name</th>
							<th>Address</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody id="tableBody">
						
					</tbody>
				</table>
				<!--DONT DELETE HERE-->
				<p></p>
				<table id="FullDurianRecordTable"></table>
				<p id="getAllDurianRecordMessage"></p>

				<br>
				<button onclick="accessToMetamask()" class="btn btn-success">Connect Metamask</button> <br>
				<p id="accountArea"></p>
				<p id="accountPos"></p>
				<br>

				<button onclick="accessToContract()" class="btn btn-warning">Connect to Smart Contract</button> <br>
				<p id="contractArea"></p>
				<br>

				
			</div>
		</div>
	</div>
	<!-- Edit Modal HTML -->
	<div id="addUserModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header">
						<h4 class="modal-title">Add User</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label>Select Position:</label>
							<select id="userType" class="form-control">
								<option value="0" class="form-control">Farm Owner</option>
								<option value="1">Distributer</option>
								<option value="2">Retailer</option>
								<option value="3">Customer</option>
							</select>
						</div>

						<div class="form-group">
							<label>Name:</label>
							<input type="text" id="userName" class="form-control"><br>
						</div>
						<div class="form-group">
							<label for="lname">Address:</label>
							<input type="text" id="userAddress" class="form-control"><br>
						</div>
						<p id="userAddErrorMessage"></p>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">

						<button id="submit" type="button" onclick="addUser()" class="btn btn-success">
							Add User
						</button>

					</div>
				</form>
			</div>
		</div>
	</div>
	<!--DONT DELETE THIS PART-->

	<!-- Edit Modal HTML -->
	<div id="editUserModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header">
						<h4 class="modal-title">Edit User</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label>Select Position:</label>
							<select id="userPosUpdate" class="form-control">
								<option value="1" class="form-control">Farm Owner</option>
								<option value="2">Distributer</option>
								<option value="3">Retailer</option>
								<option value="4">Customer</option>
							</select><br>
						</div>
						<div class="form-group">
							<label>Name:</label>
							<input type="text" id="userNameUpdate" class="form-control"><br>
						</div>
						<div class="form-group">
							<label for="lname">Address</label>
							<input type="text" id="userAddressUpdate" class="form-control" readonly><br>
						</div>
						<p id="editUserMessage"></p>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<button id="submit" type="button" onclick="editUser()" class="btn btn-success">Update
							User</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Search Modal HTML -->
	<div id="searchUserModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header">
						<h4 class="modal-title">Search User</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<label for="lname">Enter User Address:</label><br>
						<input type="text" id="getUserAddress" class="form-control"><br>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<button id="buy" type="button" onclick="getUserData()" class="btn btn-success"> Read User By
							ID</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</body>

</html>